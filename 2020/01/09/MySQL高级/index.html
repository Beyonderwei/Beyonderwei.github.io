<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="baidu-site-verification" content="093lY4ziMu" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="description" content="A personal website.">
    <meta name="keyword"  content="beyonderwei, 瞌睡遇上枕头">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!--<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>-->
    <title>
        
          MySQL高级 - beyonderwei
        
    </title>

    <link rel="canonical" href="https://beyonderwei.com/2020/01/09/MySQL高级/">

    <!-- Bootstrap Core CSS -->
    
<link rel="stylesheet" href="/css/bootstrap.min.css">


    <!-- Custom CSS --> 
    
        
<link rel="stylesheet" href="/css/dusign-dark.css">

        
<link rel="stylesheet" href="/css/dusign-common-dark.css">

        
<link rel="stylesheet" href="/css/font-awesome.css">

        
<link rel="stylesheet" href="/css/toc.css">

    
    
    <!-- Pygments Highlight CSS -->
    
<link rel="stylesheet" href="/css/highlight.css">


    
<link rel="stylesheet" href="/css/widget.css">


    
<link rel="stylesheet" href="/css/rocket.css">


    
<link rel="stylesheet" href="/css/signature.css">


    
<link rel="stylesheet" href="/css/fonts.googleapis.css">


    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">

    <!-- photography -->
    
<link rel="stylesheet" href="/css/photography.css">


    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 4.2.0"></head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- background effects start -->
    
    <!-- background effects end -->

	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            
                background-image: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url('')
                /*post*/
            
        
    }
    
    #signature{
        background-image: url('/img/signature/beyonderwei.png');
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#MySQL" title="MySQL">MySQL</a>
                            
                        </div>
                        <h1>MySQL高级</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by Beyonderwei on
                            2020-01-09
                        </span>

                        
                            <div class="blank_box"></div>
                            <span class="meta">
                                Words <span class="post-count">8.1k</span> and
                                Reading Time <span class="post-count">29</span> Minutes
                            </span>
                            <div class="blank_box"></div>
                            <!-- 不蒜子统计 start -->
                            <span class="meta">
                                Viewed <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span> Times
                            </span>
                            <!-- 不蒜子统计 end -->
                        

                    </div>
                

                </div>
            </div>
        </div>      
    </div>

    
    <div class="waveWrapper">
        <div class="wave wave_before" style="background-image: url('/img/wave-dark.png')"></div>
        <div class="wave wave_after" style="background-image: url('/img/wave-dark.png')"></div>
    </div>
    
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Beyonderwei</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">首页</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/archive/">归档</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/categories/">分类</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/about/">关于作者</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">标签</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/photography/">相册</a>
                        </li>
                        
                    

                    <li>
                        <a href="https://github.com/Beyonderwei" target="_blank">Github</a>
                    </li>
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h2 id="一、架构"><a href="#一、架构" class="headerlink" title="一、架构"></a>一、架构</h2><p>​    <strong>MySQL采用分层结构设计，可在不同需求场景中利用不同的存储引擎，插件式的存储引擎架构将查询处理和其他的系统任务以及数据存储相分离。</strong> </p>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced01.png" alt></p>
<h3 id="1-连接层"><a href="#1-连接层" class="headerlink" title="1. 连接层"></a>1. 连接层</h3><p>最上层是客户端和连接服务，包含本地的socket和大多数基于客户端/服务端工具实现的类似于tcp/ip的通信，完成<strong>连接处理</strong>、<strong>授权认证</strong>等安全方案。连接层上引入了<strong>连接池</strong>，为通过安全认证的客户端提供线程，在该层可实现SSL安全连接，服务器还会对每个安全接入的客户端进行验证，赋予操作权限。</p>
<h3 id="2-服务层"><a href="#2-服务层" class="headerlink" title="2. 服务层"></a>2. 服务层</h3><p>完成大多数的核心服务功能，如SQL接口，完成缓存的查询，SQL的分析优化及内置函数的执行，跨存储引擎的功能实现也在该层，如过程、函数等。在这一层，服务器会解析查询，并创建相应的内部解析树，完成相应的优化，如查询表的顺序、是否利用索引、最后生成相应的执行操作，如果是select操作，服务器会查询内部缓存，如果缓存的空间足够大，在解决大量的读环境中能很好的提升性能。</p>
<h3 id="3-引擎层"><a href="#3-引擎层" class="headerlink" title="3. 引擎层"></a>3. 引擎层</h3><p>存储引擎实现了MySQL中数据的存储和提取，服务器通过API和存储引擎进行通讯，不同的存储引擎的特性不同，可根据需求选取，主要用到的是MyISAM和InnoDB。</p>
<h3 id="4-存储层"><a href="#4-存储层" class="headerlink" title="4. 存储层"></a>4. 存储层</h3><p>将数据存储在裸设备的文件系统之上，并完成与存储引擎的交互。</p>
<h2 id="二、存储引擎"><a href="#二、存储引擎" class="headerlink" title="二、存储引擎"></a>二、存储引擎</h2><p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced02.png" alt></p>
<h3 id="1-InnoDB"><a href="#1-InnoDB" class="headerlink" title="1. InnoDB"></a>1. InnoDB</h3><p>​    默认的存储引擎，支持外键、事务，行锁（适合高并发），缓存索引和真实数据，对内存的要求高，内存的大小对性能有决定性影响，表的空间大，更关注于事务，安装时默认安装该存储引擎。</p>
<h3 id="2-MyISAM"><a href="#2-MyISAM" class="headerlink" title="2. MyISAM"></a>2. MyISAM</h3><p>​    不支持外键、事务，采用表锁，在操作一条记录时也会锁住整张表，不适合并发场景，只缓存索引，不缓存真实数据。表空间小，更关注性能。安装时默认安装该存储引擎。</p>
<h3 id="3-Percona的XtraDB"><a href="#3-Percona的XtraDB" class="headerlink" title="3. Percona的XtraDB"></a>3. Percona的XtraDB</h3><p>​    Percona对MySQL进行了改进，使其在功能和性能上都有了很大的提升，使用XtraDB代替了InnoDB，在性能和并发上做的更好。阿里等公司使用该引擎，或进一步优化。</p>
<h2 id="三、-索引"><a href="#三、-索引" class="headerlink" title="三、 索引"></a>三、 索引</h2><ul>
<li>索引时帮助MySQL高效获取数据的<strong>数据结构</strong>，<strong>排好序的快速查找数据结构。</strong> </li>
<li>在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构通过引用（指针）的方式引用数据，这样就可以在此数据结构的基础上实现高级算法，这种数据结构就是索引。</li>
<li>索引也是一张表，该表保存了主键与索引字段，并指向实体表记录。</li>
<li><strong>主键本身就是索引。</strong> </li>
</ul>
<h3 id="索引结构"><a href="#索引结构" class="headerlink" title="索引结构"></a>索引结构</h3><ul>
<li><strong>Btree索引</strong> （常用）</li>
<li>Hash索引</li>
<li>full-text全文索引</li>
<li>R-Tree索引</li>
</ul>
<h3 id="①-数据结构"><a href="#①-数据结构" class="headerlink" title="① 数据结构"></a>① 数据结构</h3><h5 id="B树（多路搜索树）"><a href="#B树（多路搜索树）" class="headerlink" title="B树（多路搜索树）"></a>B树（多路搜索树）</h5><p>​    通常所说的索引</p>
<h5 id="B-树"><a href="#B-树" class="headerlink" title="B+树"></a>B+树</h5><p>​    聚集索引、次要索引、复合索引、前缀索引、唯一索引</p>
<h3 id="②-优缺点"><a href="#②-优缺点" class="headerlink" title="② 优缺点"></a>② 优缺点</h3><ul>
<li>优点：<ul>
<li>提高数据的检索效率，降低数据库的IO成本</li>
<li>通过索引对数据进行排序，降低数据的排序成本，降低CPU的消耗</li>
</ul>
</li>
<li>缺点：<ul>
<li>索引也是一张表，会占用空间</li>
<li>对表进行insert update delete时不仅要保存数据，还要维护添加了索引的字段，会调整因为更新所带来的键值变化后的索引信息。</li>
</ul>
</li>
</ul>
<h3 id="③-索引分类"><a href="#③-索引分类" class="headerlink" title="③ 索引分类"></a>③ 索引分类</h3><h5 id="单值索引："><a href="#单值索引：" class="headerlink" title="单值索引："></a>单值索引：</h5><p>​    一个索引只包含单个列，一个表可以有多个单列索引</p>
<h5 id="唯一索引："><a href="#唯一索引：" class="headerlink" title="唯一索引："></a>唯一索引：</h5><p>​    索引<strong>列的值必须唯一</strong>，允许有空值</p>
<h5 id="复合索引"><a href="#复合索引" class="headerlink" title="复合索引"></a>复合索引</h5><p>​    一个索引包含了多个列</p>
<h3 id="④-基本语法"><a href="#④-基本语法" class="headerlink" title="④ 基本语法"></a>④ 基本语法</h3><h5 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h5><p><code>CREATE [UNIQUE] INDEX indexName ON tableName(columnName);</code></p>
<p><code>ALTER tableName ADD [UNIQUE] INDEX [indexName] ON(columnName);</code> </p>
<ul>
<li>加UNIQUE表示唯一索引</li>
<li>单值索引：一个字段   多值索引：多个字段</li>
</ul>
<h5 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h5><p><code>DROP INDEX [indexName] ON tableName;</code></p>
<h5 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h5><h3 id="②-注意点"><a href="#②-注意点" class="headerlink" title="② 注意点"></a>② 注意点</h3><ul>
<li>索引会影响到查找和ORDER BY 的排序</li>
<li>一般不实际删除表的数据，而是通过标志位（is_deleted）的形式使之无效，以此来维护索引的结构，避免查到一半查不到了，这种情况导致的查询变慢可通过重建索引来解决。</li>
<li>索引是提高效率的一个因素，需要根据点击数据不断的优化。</li>
<li>经常更新删除的数据不适合添加索引</li>
<li>一张表的索引最好不要超过5个</li>
</ul>
<h2 id="四、-索引与SQL"><a href="#四、-索引与SQL" class="headerlink" title="四、 索引与SQL"></a>四、 索引与SQL</h2><h3 id="1-创建索引"><a href="#1-创建索引" class="headerlink" title="1. 创建索引"></a>1. 创建索引</h3><h4 id="①-单值索引"><a href="#①-单值索引" class="headerlink" title="① 单值索引"></a>① 单值索引</h4><p><code>create index idx_user_name on user(name);</code> </p>
<p><strong>索引命名</strong>：</p>
<ul>
<li>以idx 开头，接着是表名和创建索引的字段名</li>
<li>各部分以下环线分开，这样通过创建了索引的字段来查询就会很快。</li>
</ul>
<h4 id="②-复合索引"><a href="#②-复合索引" class="headerlink" title="② 复合索引"></a>② 复合索引</h4><p><code>create index idx_user_nameEmail on user(name,email);</code> </p>
<p><strong>索引命名：</strong> </p>
<ul>
<li>多个索引字段按小驼峰命名接在表名后</li>
</ul>
<h3 id="2-SQL性能下降"><a href="#2-SQL性能下降" class="headerlink" title="2. SQL性能下降"></a>2. SQL性能下降</h3><h4 id="①-性能下降原因"><a href="#①-性能下降原因" class="headerlink" title="① 性能下降原因"></a>① 性能下降原因</h4><p>​    主要时执行时间长或等待时间长，原因如下：</p>
<ul>
<li>查询语句写的不好</li>
<li>索引失效</li>
<li>多表关联查询，关联的表太多（设计缺陷或万不得已）</li>
<li>服务器调优和参数设置等问题</li>
</ul>
<h4 id="②-Join查询"><a href="#②-Join查询" class="headerlink" title="② Join查询"></a>② Join查询</h4><h3 id="3-SQL的执行顺序"><a href="#3-SQL的执行顺序" class="headerlink" title="3. SQL的执行顺序"></a>3. SQL的执行顺序</h3><ul>
<li><p>手写的SQL顺序</p>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced03.png" alt></p>
</li>
<li><p>MySQL内部的解析顺序</p>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced04.png" alt></p>
</li>
<li><p>执行的顺序</p>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced05.png" alt></p>
</li>
</ul>
<h3 id="4-常用SQL-JOINS"><a href="#4-常用SQL-JOINS" class="headerlink" title="4. 常用SQL JOINS"></a>4. 常用SQL JOINS</h3><ul>
<li>左连接(右连接同理)</li>
</ul>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced06.png" alt></p>
<ul>
<li><p>内连接</p>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced07.png" alt></p>
</li>
<li><p>左连接去重</p>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced08.png" alt></p>
</li>
<li><p>全连接(MySQL不支持)，通过union去重，连接左连接和右连接</p>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced09.png" alt></p>
</li>
</ul>
<h2 id="五、-创建索引-OR-不创建"><a href="#五、-创建索引-OR-不创建" class="headerlink" title="五、 创建索引 OR 不创建"></a>五、 创建索引 OR 不创建</h2><h3 id="1-需要创建索引的情况"><a href="#1-需要创建索引的情况" class="headerlink" title="1. 需要创建索引的情况"></a>1. 需要创建索引的情况</h3><ul>
<li>主键自动创建唯一索引</li>
<li>频繁作为查询条件的字段应该创建索引</li>
<li>查询中与其他表关联的字段，外键关系建立索引，即作为外键的字段</li>
<li>单值、复合索引的选择（<strong>高并发下倾向创建复合索引</strong>）</li>
<li>查询中排序的字段（排序字段若通过索引去访问将大大提高排序速度）</li>
<li>查询中统计或分组字段</li>
</ul>
<h3 id="2-不需要创建索引"><a href="#2-不需要创建索引" class="headerlink" title="2. 不需要创建索引"></a>2. 不需要创建索引</h3><ul>
<li>频繁更新的字段不适合创建索引，（因为更新也要更新索引）</li>
<li>Where条件里用不到的字段不建索引</li>
<li>表记录太少（300万以内不用建）</li>
<li>重复且分布均匀的表字段不建索引，如果某个字段的重复内容过多（<strong>如性别、国籍等</strong>），为他建索引没有什么实际效果，反而增减了维护索引的成本。</li>
</ul>
<h3 id="3-索引的选择性"><a href="#3-索引的选择性" class="headerlink" title="3. 索引的选择性"></a>3. 索引的选择性</h3><p>​    <strong>索引的选择性</strong>表示索引列中不同值得数目与表中记录数的比，例如，表中有100条记录，索引列有99个不同的值，那么这个选择性就是99/100=0.99。选择性越接近1，这个索引的效率就越高。</p>
<h2 id="六、-性能分析"><a href="#六、-性能分析" class="headerlink" title="六、 性能分析"></a>六、 性能分析</h2><h3 id="1-MySQL-Query-Optimizer-查询优化器"><a href="#1-MySQL-Query-Optimizer-查询优化器" class="headerlink" title="1. MySQL Query Optimizer(查询优化器)"></a>1. MySQL Query Optimizer(查询优化器)</h3><ul>
<li>MySQL中有专门负责优化SELECT语句的优化器模块，该模块主要通过计算分析系统中手机的统计信息，为客户端请求的Query提供他人为最优的执行计划（但是他认为最优的检索方式不见得是DBA人为最优的）</li>
<li>当客户端向MySQL请求一条Ｑｕｅｒｙ时，命令解析器模块完成请求分类，区别出是SELECT并转发给MySQL Query Optimizer时，MySQL Query Optimizer首先对整条Query中的查询条件进行简化和转换，如去掉一些无用或者显而易见的条件、结构调整等，然后分析Query中的Hint信息（如果有）,看监视Hint信息是否可以完全确定Query的执行计划，如果没有Hint或Hint信息不足以完全确定执行计划，则会读取所涉及对象的统计信息，根据Query进行谐响应的计算分析，然后得出最后的执行计划。</li>
</ul>
<h3 id="2-MySQL的常见瓶颈"><a href="#2-MySQL的常见瓶颈" class="headerlink" title="2. MySQL的常见瓶颈"></a>2. MySQL的常见瓶颈</h3><ul>
<li>CPU：CPU饱和的时候一般发生在数据装入内存或从磁盘上读取数据的时候</li>
<li>IO：磁盘的IO瓶颈发生在装入数据远大于内存容量的时候</li>
<li>服务器硬件的性能瓶颈：<strong>top，free，iostat，vmstat</strong>来查看系统的性能状态。</li>
</ul>
<h2 id="七、Explain（计划）"><a href="#七、Explain（计划）" class="headerlink" title="七、Explain（计划）"></a>七、Explain（计划）</h2><h3 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h3><p>​    使用Explain关键字可以模拟优化器执行SQL查询语句，从而知道MySQL是如何处理你的SQL语句的，分析查询语句或是表结构的性能瓶颈。</p>
<h3 id="2-作用"><a href="#2-作用" class="headerlink" title="2. 作用"></a>2. 作用</h3><ul>
<li>查看表的读取顺序（id，table字段）</li>
<li>展现数据读取操作的操作类型（select_type）</li>
<li>哪些索引可以使用</li>
<li>哪些索引被实际使用</li>
<li>表之间的引用</li>
<li>每张表有多少行被优化器查询</li>
</ul>
<h3 id="3-使用"><a href="#3-使用" class="headerlink" title="3. 使用"></a>3. 使用</h3><p>​    Explain + SQL语句，得到分析结果。</p>
<h4 id="①-包含信息"><a href="#①-包含信息" class="headerlink" title="① 包含信息"></a>① 包含信息</h4><p>原则：小表驱动大表。逐步调优，实现先加载小的，后加载大的。</p>
<h5 id="id："><a href="#id：" class="headerlink" title="*id："></a>*id：</h5><p>​    select查询的序列号，包含一组数字，表示查询中执行select子句或操作表的顺序，NULL最后执行。</p>
<ul>
<li>id相同，执行顺序由上至下（table字段）</li>
<li>id不同，如果是子查询，id的序列号会递增，id值越大，所对应的table字段的表越先执行。</li>
<li>id相同和不同：id值越大，优先级越高，越先执行，id相同的部分是一组，从上往下执行。</li>
</ul>
<p>注：table中的derivedx表示衍生表，x代表由谁执行后衍生的。</p>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced10.png" alt></p>
<h5 id="select-type"><a href="#select-type" class="headerlink" title="select_type"></a>select_type</h5><ul>
<li><p>SIMPLE</p>
<p>简单的select查询，查询中不包含子查询或UNION</p>
</li>
<li><p>PRIMARY</p>
<p>查询中若包含任何复杂的子部分时，最外层查询被标记为子查询（最后加载的那个）</p>
</li>
<li><p>SUBQUERY</p>
<p>在SELECT或WHERE列表中包含了子查询</p>
</li>
<li><p>DERIVED</p>
<p>在FROM列表中包含的子查询被标记为DERIVED（衍生表），MySQL会递归执行这些子查询，把结果放在临时表中。</p>
</li>
<li><p>UNION</p>
<p>若第二个SELECT出现在UNION之后，则被标记为UNION；若UNION包含在FROM子句的子查询中，外层SELECT将被标记为DERIVED</p>
</li>
<li><p>UNION RESULT</p>
<p>从UNION表获取结果的SELECT</p>
</li>
</ul>
<h5 id="table"><a href="#table" class="headerlink" title="table"></a>table</h5><p>​    关于哪一张表</p>
<h5 id="type"><a href="#type" class="headerlink" title="*type"></a>*type</h5><p>​    访问类型排列，显示了查询使用了哪种类型，从好到差的排列顺序为：<strong>systerm&gt;const&gt;eq_ref&gt;ref&gt;range&gt;index&gt;ALL</strong> </p>
<p>注：ALL表示全表扫描，一般来说至少达到range级别，最好能达到ref。（<strong>达到百万级别的表才需要优化</strong>）</p>
<ul>
<li>systerm：表只有一行记录（等于系统表），是const类型的特例，平时不会出现，可忽略不计</li>
<li>const：表示通过索引一次就找到了，const用来比较<strong>primary key</strong>或<strong>unique</strong>索引，因为只匹配一行数据，所以很快，如果将主键至于WHERE列表中，MySQL就将该查询转换为一个常量。</li>
<li>eq_ref：唯一性索引扫描，对于每个索引键，表中只有一条记录与之匹配，常见于主键或唯一索引扫描。（只有一条符合匹配）</li>
<li><strong>ref</strong>：非唯一性索引扫描，返回匹配某个单独值的所有行，本质上也是一种索引访问，它返回所有匹配某个单独值得行，然而它可能会找到多个符合条件得行，所以它应该属于查找和扫描得混合体。（有多条符合匹配）</li>
<li><strong>range</strong>：只检索给定范围得行，使用一个索引来选择行，key列表显示了使用了哪些索引。一般就是在你得where语句中出现了between、&lt;、&gt;、in等得查询。这种范围扫描索引比全表扫描要好，因为它只需要开始于索引得某一个点，而不用扫描全部索引。（如id大于多少、小于多少）</li>
<li><strong>index</strong>：Full Index Scan ，index于All的区别为index只遍历索引树。这通常要比ALL快，因为索引文件通常要比数据文件小。也就是说，虽然All和index都是读全表，但是index是从索引中读取的，而all是从硬盘中读取的。</li>
<li>all：全表扫描</li>
</ul>
<h5 id="possible-keys"><a href="#possible-keys" class="headerlink" title="possible_keys"></a>possible_keys</h5><p>​    显示可能用在这张表中的索引，一个或多个，查询涉及到的字段上若存在索引，则该索引将被列出，<strong>但在该查询中不一定被使用到</strong> </p>
<h5 id="key"><a href="#key" class="headerlink" title="*key"></a>*key</h5><p>​    表示实际使用到的索引，如果位NULL则表示没有使用索引</p>
<p>​    查询中若使用到了覆盖索引，则该索引仅出现在key列表中。（<strong>覆盖索引：</strong> select的数据列只用从索引中取得，不必读取数据行，MySQL可以利用索引返回select列表中的字段，而不必根据索引再次读取文件，即<strong>查询列要被所建的索引覆盖</strong>。如下图：）</p>
<ul>
<li>如果用到覆盖索引，select列表中只取出需要的列，不可select*</li>
</ul>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced11.png" alt></p>
<h5 id="key-len"><a href="#key-len" class="headerlink" title="key_len"></a>key_len</h5><p>​    表示索引中使用的字节数，可通过该列计算查询中使用的索引长度，在不损失精度的情况下，长度越短越好。（在建了索引的前提下，查询条件越精确，key_len的值越大）</p>
<p>​    key_len显示的值为索引字段的最大可能长度，并非实际使用长度，该值是根据表定义计算得到，不是通过表内检索出来的。</p>
<h5 id="ref"><a href="#ref" class="headerlink" title="*ref"></a>*ref</h5><p>​    显示索引的哪一列被使用了（索引的具体引用情况），如果可能的话，是一个常数。哪些列或常量被用于查找索引列上的值。格式为（库名.表名.字段名 或 const）</p>
<h5 id="rows"><a href="#rows" class="headerlink" title="*rows"></a>*rows</h5><p>​    表示每张表有多少行被优化器查询过（加起来越少越好）。</p>
<h5 id="Extra（重要）"><a href="#Extra（重要）" class="headerlink" title="Extra（重要）"></a>Extra（重要）</h5><p>​    包含不适合在其他列显示，但<strong>十分重要</strong>的额外信息。</p>
<p><strong>注意：</strong>要么不建索引，要么就按照索引的顺序去查，不然很容易产生文件内排序、临时表等问题。</p>
<ul>
<li><p><strong>Using filesort</strong>：说明MySQL会对数据使用一个外部的索引排序，而不是按照表内的索引排序进行读取，MySQL无法利用索引完成的排序操作称为“文件排序”，<strong>需要尽快优化</strong>。<strong>MySQL自己在内部产生了一次排序</strong>，会导致性能下降。因此尽可能的使用原本创建好的索引和索引的顺序。</p>
</li>
<li><p><strong>Using temporary</strong>：使用了临时表保存中间结果，MySQl在对中间结果排序时使用临时表，常见于排序order by 和分组查询 group by。（<strong>一定要赶紧优化，需要见表、删表、性能急速下降,如下图</strong>）</p>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced12.png" alt></p>
</li>
<li><p>Using index：</p>
<ul>
<li><p>表示相应的select操作中使用了覆盖索引（Covering Index），避免访问了表的数据行，效率不错。</p>
</li>
<li><p>如果同时出现using where ，表明索引被用来执行索引键值的查找</p>
</li>
<li>如果没有同时出现using where，表明索引用来读取；数据而非执行查找动作。</li>
</ul>
</li>
<li><p>Using where：表明使用了where过滤</p>
</li>
<li><p>Using join buffer：使用了连接缓存</p>
</li>
<li><p>impossible where：where子句的值总是false，不能用来获取任何元组</p>
</li>
<li><p>select tables optimized away（了解）：在没有GROUP BY 子句的情况下，基于索引优化MIN/MAX操作或者对于M有ISAM存储引擎优化COUNT（*）操作，不必等到执行阶段再进行计算，查询执行计划生成的阶段即可完成优化。</p>
</li>
<li><p>distinct（了解）：优化distinct操作，在找到第一匹配的元组胡即停止找同样值得动作。</p>
</li>
</ul>
<h2 id="八、索引优化"><a href="#八、索引优化" class="headerlink" title="八、索引优化"></a>八、索引优化</h2><h3 id="1-索引分析"><a href="#1-索引分析" class="headerlink" title="1. 索引分析"></a>1. 索引分析</h3><h4 id="①-单表"><a href="#①-单表" class="headerlink" title="① 单表"></a>① 单表</h4><p>​    范围需求字段建了索引以后，其后的索引会失效，降低效率。</p>
<h4 id="②-两表"><a href="#②-两表" class="headerlink" title="② 两表"></a>② 两表</h4><p>​    由左右连接的特性来决定，左连接则左表一定全要，从右表搜索，此时要在右表建立索引。</p>
<p>​    <strong>注：左连接加右表，右连接加左表，如果DBA已经建好索引，可以通过改变左右连接来提高效率。</strong> </p>
<h4 id="③-三表"><a href="#③-三表" class="headerlink" title="③ 三表"></a>③ 三表</h4><p>​    依然按照两表中的原则，索引最好设置在需要经常查询的字段中。</p>
<h4 id="④-结论"><a href="#④-结论" class="headerlink" title="④ 结论"></a>④ 结论</h4><ul>
<li>尽可能减少Join语句中的NestedLoop的循环总次数，永远用小表驱动大表。</li>
<li>优先优化NestedLoop的内层循环</li>
<li>保证Join语句中被驱动表上Join条件字段已经被索引</li>
<li>当无法把凭证被驱动表的Join条件字段被索引且内存资源充足的前提下，不要太吝啬JoinBuffer的设置。</li>
</ul>
<h3 id="2-索引失效"><a href="#2-索引失效" class="headerlink" title="2. 索引失效"></a>2. 索引失效</h3><h4 id="①-最好使用全值匹配"><a href="#①-最好使用全值匹配" class="headerlink" title="① 最好使用全值匹配"></a>① 最好使用全值匹配</h4><p>​    查询条件中直接用值匹配，如 name = “张三”</p>
<h4 id="②-最佳左前缀法则（重要）"><a href="#②-最佳左前缀法则（重要）" class="headerlink" title="② 最佳左前缀法则（重要）"></a>② 最佳左前缀法则（重要）</h4><p>​    如果索引中引入了多列，要遵守该原则，查询从索引的最左前列开始（如果顺序不同，没有跳过某个列，MySQL优化器会进行优化），并且<strong>不跳过索引中的列</strong>。</p>
<p>​    <strong>order by</strong> 如果不按照索引顺序，几乎都会产生文件排序。</p>
<p>​    <strong>group by</strong> 如果不按照索引顺序，几乎都会产生文件排序和临时表。group by 分组之前需要排序。</p>
<h4 id="③-不再索引上做任何操作"><a href="#③-不再索引上做任何操作" class="headerlink" title="③ 不再索引上做任何操作"></a>③ 不再索引上做任何操作</h4><p>​    在索引上做计算、函数、（自动或手动）类型转换，都会导致索引失效，转为全表扫描。</p>
<h4 id="④-范围条件右边不可用"><a href="#④-范围条件右边不可用" class="headerlink" title="④ 范围条件右边不可用"></a>④ 范围条件右边不可用</h4><p>​    存储引擎不能使用范围条件右边的列。如 pos = 1 and age &gt; 18 and name = “zhangsan”   此时，最后 name = “zhangsan”  就无法使用索引，但前面两个就能用到。</p>
<h4 id="⑤-使用覆盖索引"><a href="#⑤-使用覆盖索引" class="headerlink" title="⑤ 使用覆盖索引"></a>⑤ 使用覆盖索引</h4><p>​    尽量使用索引覆盖（只访问某些或全部索引列的查询），减少使用select *</p>
<h4 id="⑥-避免使用-和-lt-gt"><a href="#⑥-避免使用-和-lt-gt" class="headerlink" title="⑥ 避免使用 != 和 &lt;&gt;"></a>⑥ 避免使用 != 和 &lt;&gt;</h4><p>​    8.0版本进行了优化，但是还是range级别，Extra为 useing index condition。但是还是尽量避免使用。</p>
<p>举例：where name != “zhangsan”</p>
<h4 id="⑦-避免使用is-not-null"><a href="#⑦-避免使用is-not-null" class="headerlink" title="⑦ 避免使用is (not) null"></a>⑦ 避免使用is (not) null</h4><p>​    name is null；    <strong>可能在高版本会用到索引，待测</strong></p>
<h4 id="⑧-like以通配符开头"><a href="#⑧-like以通配符开头" class="headerlink" title="⑧ like以通配符开头"></a>⑧ like以通配符开头</h4><p>​    以通配符开头（’%abc‘）索引失效，导致全表扫描。</p>
<p>​    like 以百分号结尾，type 为 range，因此like “abc%” 后的也不能被用到索引。</p>
<p><strong>解决like “%字符串%” 时，索引不被使用的解决办法</strong></p>
<p>​    通过覆盖索引来解决问题，可以从ALL提升到index</p>
<h4 id="⑨-字符串不加单引号（重要）"><a href="#⑨-字符串不加单引号（重要）" class="headerlink" title="⑨ 字符串不加单引号（重要）"></a>⑨ 字符串不加单引号（重要）</h4><p>​    varchar类型的数据在进行匹配的时候，如果不加单引号，可能导致隐式的类型转换，如数字与字符串之间的转换，因此会导致索引失效。</p>
<h4 id="⑩少用or"><a href="#⑩少用or" class="headerlink" title="⑩少用or"></a>⑩少用or</h4><p>​    如： name = “zhangsan” OR name = “lisi”, 会导致索引失效。8.0以上可能是range。</p>
<h3 id="3-一般性建议"><a href="#3-一般性建议" class="headerlink" title="3. 一般性建议"></a>3. 一般性建议</h3><ul>
<li>对于单键索引，尽量选择针对当前query过滤性更好的索引</li>
<li>在选择组合索引的时候，当前Query中过滤性最好的字段在索引字段顺序中，位置越靠前越好</li>
<li>在选择组合索引的时候，尽量选择可以能够包含当前query中的where子句中更多字段的索引。</li>
<li>尽可能通过分析统计信息和调整query的写法来达到选择合适索引的目的。</li>
</ul>
<h2 id="九、-查询截取分析"><a href="#九、-查询截取分析" class="headerlink" title="九、 查询截取分析"></a>九、 查询截取分析</h2><h3 id="0-分析优化过程"><a href="#0-分析优化过程" class="headerlink" title="0. 分析优化过程"></a>0. 分析优化过程</h3><ul>
<li>观察，至少跑一天，看看生产中慢SQL的情况</li>
<li>开启慢查询日志，设置阈值，比如超过三秒的SQL语句，并抓取</li>
<li>explain + 慢SQL分析</li>
<li>show profile，查询SQL在MySQL服务器里面的执行细节和生命周期情况</li>
<li>DBA进行SQL数据库服务器的参数调优</li>
</ul>
<h3 id="1-查询优化"><a href="#1-查询优化" class="headerlink" title="1. 查询优化"></a>1. 查询优化</h3><h4 id="①-永远小表驱动大表"><a href="#①-永远小表驱动大表" class="headerlink" title="① 永远小表驱动大表"></a>① 永远小表驱动大表</h4><p>​    即小的数据集，驱动大的数据集，从而减少IO次数，</p>
<ul>
<li><p>B表的数据集小于A表时，用in优于exists</p>
</li>
<li><p>A表的数据集小于B表时，用exists优于in</p>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced13.png" alt></p>
</li>
</ul>
<h4 id="②-in和exists"><a href="#②-in和exists" class="headerlink" title="② in和exists"></a>② in和exists</h4><ul>
<li><p>EXISTS</p>
<p><code>SELECT ... FROM table WHERE EXISTS(subquery)</code> </p>
<p>将主拆线呢的数据，放到子查询中做条件验证，根据验证结果（true或false）来决定主查询的数据结果是否得以保留。</p>
</li>
<li><p>提示：</p>
<ul>
<li>EXISTS(subquery)只返回RTUE或FALSE，因此子查询中的SELECT *也可以是SELECT 1或SELECT ‘X’，官方说法是实际执行时会忽略SELECT清单，因此没区别</li>
<li>EXISTS子查询的实际执行过程可能经过了优化而不是我们理解上的逐条对比，可实际验证是否有效率问题</li>
<li>EXISTS子查询往往也可以用条件表达式、其他子查询或者JOIN来代替，何种最优需要具体问题具体分析。</li>
</ul>
</li>
</ul>
<h4 id="③-order-by关键字优化"><a href="#③-order-by关键字优化" class="headerlink" title="③ order by关键字优化"></a>③ order by关键字优化</h4><h5 id="最佳左前缀原则依然有效"><a href="#最佳左前缀原则依然有效" class="headerlink" title="最佳左前缀原则依然有效"></a>最佳左前缀原则依然有效</h5><ul>
<li>order by后所用的索引<strong>要按照创建的顺序，不能间断</strong>，否则会产生文件排序。跟前面的内容无关。</li>
<li>默认是升序，如果同时使用降序和升序，即使按照索引顺序，也会导致文件排序。除非所有索引都降序，且按照索引顺序，就不会产生文件排序。</li>
</ul>
<h5 id="filesort排序算法"><a href="#filesort排序算法" class="headerlink" title="filesort排序算法"></a>filesort排序算法</h5><ul>
<li>双路排序：MySQL4.1之前使用的是该算法，取一批数据需要进行两次扫描。</li>
<li>单路排序：4.1版本以后采用单路算法，一次读取，在buffer中排序，只用读一次，总体好于双路排序。</li>
<li>结论：单路排序可能会因为sort_buffer的太小产生多次IO，还不如双路排序，因此需要进行相应的配置。</li>
</ul>
<h5 id="提升性能方法"><a href="#提升性能方法" class="headerlink" title="提升性能方法"></a>提升性能方法</h5><ul>
<li><p>加order by 就尽量不要SELECT *，因为如果产生了filesort就会增加缓存，把sort_buffer_size给用满了，导致产生多次IO。</p>
</li>
<li><p>有filesort可尝试提高sort_buffer_size，根据系统能力去提高，该参数针对每个进程。</p>
</li>
<li><p>有filesort可尝试提高max_length_for_sort_data，太大，数据总量超过sort_buffer_size会导致高的磁盘IO和低的处理器利用率。</p>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced14.png" alt></p>
</li>
</ul>
<h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><ul>
<li><p>order能使用最左前缀索引</p>
</li>
<li><p>如果最左前缀为常量，order by也能使用索引</p>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced15.png" alt></p>
</li>
</ul>
<h4 id="④-group-by关键字优化"><a href="#④-group-by关键字优化" class="headerlink" title="④ group by关键字优化"></a>④ group by关键字优化</h4><p>​    group by 的实质是先排序后分组，遵照索引建的最佳左前缀，当无法使用索引列，增大sort_buffer_size 和 max_length_for_sort_data的参数设置，</p>
<p>​    where高于having ，因此能写在where里的条件就不要到having中去限制。</p>
<h3 id="2-慢查询日志"><a href="#2-慢查询日志" class="headerlink" title="2. 慢查询日志"></a>2. 慢查询日志</h3><h4 id="①-简介"><a href="#①-简介" class="headerlink" title="① 简介"></a>① 简介</h4><ul>
<li>MySQl的慢查询日志是MySQL提供的一种日志记录，它用来记录在MySQL中响应时间超过阈值的语句，具体指运行时间超过long_query_time值得SQL，则会记录在慢查询日志中。</li>
<li>long_query_time得默认值是10，即10秒钟</li>
</ul>
<h4 id="②-使用"><a href="#②-使用" class="headerlink" title="② 使用"></a>② 使用</h4><ul>
<li><p>默认MySQL数据库没有开启，需要我们手动得开启慢查询日志。非调优需要不建议开启，因为开启慢查询会多少对性能造成影响，慢查询日志支持将日志写入文件。</p>
</li>
<li><p>命令：</p>
<ul>
<li><code>SHOW VARIABLES LIKE &#39;%slow_query_log%&#39;;</code>    查看是否开启及存储文件</li>
<li><code>set global show_query_log=1;</code>     开启慢查询（只对当前数据库有效，重启后就会失效）</li>
<li><code>set global long_query_time=3;</code>   设置阈值为3 （本库有效，重启无效，重开一个连接通过show才能查到）</li>
<li><code>SHOW global status like &#39;%Slow_queries%&#39;;</code>   查询日志的条数</li>
</ul>
</li>
<li><p>永久开启（不建议）</p>
<ul>
<li>修改my.cnf在[mysqld]下增加或修改参数</li>
<li>slow_query_log=1</li>
<li>slow_query_log_file=/var/lib/mysql/xxx.log   (缺省得文件名为主机+slow.log)</li>
<li>long_query_time = 3</li>
<li>log_output=FILE</li>
</ul>
</li>
<li><p>执行测试</p>
<p>可通过select sleep(5); 等方式来执行语句，这样如果阈值低于5秒得话，该语句会被记录。</p>
</li>
</ul>
<h4 id="③-分析工具"><a href="#③-分析工具" class="headerlink" title="③ 分析工具"></a>③ 分析工具</h4><p>​        在生产中，手工分析日志比较麻烦，因此MySQL提供了日志分析工具，<strong>mysqldumpslow</strong>。通过<code>mysqldumpslow --help</code> 查看如何使用，查询出相关数据</p>
<ul>
<li>s：按照何种方式排序</li>
<li>c：访问次数</li>
<li>l：锁定时间</li>
<li>r：返回记录</li>
<li>t：以查询总时间方式从大到小排序</li>
<li>al：平均锁定时间</li>
<li>ar：平均返回记录</li>
<li>at：平均查询时间</li>
<li>g：后面搭配正则表达式，大小写不敏感。</li>
</ul>
<h3 id="3-批量数据脚本"><a href="#3-批量数据脚本" class="headerlink" title="3. 批量数据脚本"></a>3. 批量数据脚本</h3><p>​    以插入1000W条数据为例</p>
<ul>
<li><p><code>set global log_bin_trust_function_creators=1;</code>   开启二进制方法创建</p>
<p>或在[mysqld] 下加上 log_bin_trust_function_creators=1</p>
</li>
<li><p>创建函数，保证每条数据都不同</p>
<ul>
<li><p>随机产生字符串</p>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced16.png" alt></p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>随机产生编号</p>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced17.png" alt></p>
</li>
</ul>
<ul>
<li><p>创建存储函数,一次插入批量数据，如几十万的数据(插入其他数据同理)</p>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced18.png" alt></p>
</li>
<li><p>调用</p>
<ul>
<li>DELIMITER ;     将结束符改为分号</li>
<li>CALL 函数名来调用</li>
</ul>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced19.png" alt></p>
</li>
</ul>
<h3 id="4-Show-Profile"><a href="#4-Show-Profile" class="headerlink" title="4. Show Profile"></a>4. Show Profile</h3><p><strong>简介：</strong></p>
<p>​    是mySQL提供的可以用来分析当前会话中语句执行的资源消耗情况，可以用于SQL的调优测量，默认是关闭状态，并保存最近15次的运行结果。</p>
<p><strong>命令：</strong></p>
<ul>
<li><p><code>show variables like &#39;profiling;&#39;</code>    查看是否开启</p>
</li>
<li><p><code>set profiling=on;</code>    打开profile</p>
</li>
<li><p><code>show profiles;</code>    查看执行过的SQL，包含执行时间和SQL语句、查询ID信息。</p>
</li>
<li><p><code>show profile cpu,block io for query 查询ID;</code>  列出上面某个查询的详细过程信息。一条SQL的完整生命周期。</p>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced21.png" alt></p>
</li>
<li><p><strong>结果中需要注意的点：</strong></p>
<ul>
<li>converting HEAP to MyISAM  查询结果太大，内存不够，需要往磁盘存储</li>
<li>Creating tmp table   创建了临时表（拷贝数据到临时表，用完再删）</li>
<li>Copying to tmp table on disk  把内存中临时表复制到磁盘，<strong>危险</strong></li>
<li>locked</li>
</ul>
</li>
<li><p>除了cpu block io还有其他的开销信息，如下表</p>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced20.png" alt></p>
</li>
</ul>
<h3 id="5-全局查询日志"><a href="#5-全局查询日志" class="headerlink" title="5. 全局查询日志"></a>5. 全局查询日志</h3><p>​    <strong>只能在测试环境用，不能在生产环境用。</strong> </p>
<h4 id="①-配置使用"><a href="#①-配置使用" class="headerlink" title="① 配置使用"></a>① 配置使用</h4><p>在my.cnf设置如下</p>
<ul>
<li>general_log=1    开启</li>
<li>general_log_file=/path/logfile    日志文件路径</li>
<li>log_output=FILE    输出格式</li>
</ul>
<h4 id="②-命令使用"><a href="#②-命令使用" class="headerlink" title="② 命令使用"></a>② 命令使用</h4><ul>
<li><code>set global general_log=1;</code> </li>
<li><code>set global log_output=&#39;TABLE&#39;;</code> </li>
<li>然后所编写的SQL语句会记录到mysql数据库里的general_log表</li>
<li><code>select * from mysql.general_log;</code> 查看该表的数据</li>
</ul>
<h2 id="八、-MySQL锁机制"><a href="#八、-MySQL锁机制" class="headerlink" title="八、 MySQL锁机制"></a>八、 MySQL锁机制</h2><h3 id="1-简介-1"><a href="#1-简介-1" class="headerlink" title="1. 简介"></a>1. 简介</h3><p>​    锁是计算机协调多个进程或线程并发访问某一资源的机制</p>
<p>​    在数据库中，除传统的CPU、RAM、IO等资源的征用以外，数据也是一种很多用户共享的资源，如何保证数据并发访问的一致性、有效性是所有数据库必须解决的一个问题，锁冲突也是并发访问性能的一个重要的因素，锁对于数据库尤为的重要，也更复杂。</p>
<h3 id="2-分类"><a href="#2-分类" class="headerlink" title="2. 分类"></a>2. 分类</h3><ul>
<li>读锁（共享锁）：针对同一份数据，多个读操作可同时进行，互不影响</li>
<li>写锁（排他锁）：当前写操作未完成之前，会阻断其他的写锁和读锁。</li>
</ul>
<h3 id="3-表锁"><a href="#3-表锁" class="headerlink" title="3. 表锁"></a>3. 表锁</h3><p>​    偏向于<strong>MyISAM存储引擎</strong>，开销小，加锁快，无死锁，锁定粒度大，发生锁冲突的概率最高，并发度低。</p>
<p><strong>MyISQM在执行select前会对所涉及的表加读锁，在执行增删改之前，会对涉及的表加写锁。</strong></p>
<h4 id="①-命令"><a href="#①-命令" class="headerlink" title="① 命令"></a>① 命令</h4><ul>
<li><code>show open tables;</code>    查看表上加过的锁，0未锁</li>
<li><code>lock table 表名 read(write);</code>    给表加读锁或者写锁</li>
<li><code>unlock tables;</code>    解除库中所有的锁</li>
</ul>
<p><strong>注意点（针对MyISAM引擎）：</strong></p>
<ul>
<li>加表的读锁以后，只能读该表，不能读其他表或写这个表，一定要解除了自己加的这个锁以后才能做其他操作。其他连接要进行写操作要被堵塞。</li>
<li>对表加写锁后，该连接可读、改自己锁的表，同样在没有解锁前不能操作其他表。其他表对该表查询和写同样阻塞。</li>
</ul>
<h4 id="②-表锁分析"><a href="#②-表锁分析" class="headerlink" title="② 表锁分析"></a>② 表锁分析</h4><p><code>show status like &#39;table%&#39;;</code>   可以查看表锁的情况，</p>
<ul>
<li>Table_locks_immediate：产生表锁的次数，表示可以立即获取锁的查询次数，每立即获取锁值加一</li>
<li>Table_locks_waited：出现表级锁定征用而发生等待的次数（不能立即获取锁的次数，每等待一次锁值加一），此值高说明存在着严重的表级锁争用情况。</li>
</ul>
<p><strong>注意：</strong> MyISAM的读写锁调度是写优先，因此不适合作为写为主的情况，写锁后其他线程不能做任何操作，大量更新会使查询很难得到锁，从而造成永远阻塞。</p>
<h3 id="4-行锁"><a href="#4-行锁" class="headerlink" title="4. 行锁"></a>4. 行锁</h3><p>​    偏向于InnoDB引擎，开销大、加锁慢，会出现死锁，锁的粒度小，发生冲突的可能小，并发高。<strong>InnoDB支持事务，并采用了行锁。</strong> （复习事务的隔离级别，和数据库事务。） </p>
<h4 id="①-行锁变表锁"><a href="#①-行锁变表锁" class="headerlink" title="① 行锁变表锁"></a>① 行锁变表锁</h4><p>​    <strong>重要提示：</strong> 索引失效会导致行锁变表锁，常出现索引失效就是自动类型转换，即varchar数据不加单引号。这时操作数据会导致索引失效，操作过程所住整个表。</p>
<h4 id="②-间隙锁危害"><a href="#②-间隙锁危害" class="headerlink" title="② 间隙锁危害"></a>② 间隙锁危害</h4><p>​    当我们用范围条件而不是相等条件去检索数据的时候，并请求共享和排他锁时，InnoDB会给符合条件的已有数据的索引加索，对于键值在条件范围内但不存在的记录，叫做间隙（GAP）。</p>
<p>​    当锁定一个范围的键值以后，即使某些不存在的键值也会被无辜的锁定，而造成在锁定的时候，无法插入锁定范围内的任何数据</p>
<h4 id="③-优化分析"><a href="#③-优化分析" class="headerlink" title="③ 优化分析"></a>③ 优化分析</h4><ul>
<li><code>show status like &#39;innodb_row_lock&#39;;</code>    查看行锁的状态</li>
<li>innodb_row_lock_current_waits:  当前正在等待的锁的数量</li>
<li><strong>innodb_row_lock_time</strong>：  从系统锁定到现在锁定的总时间长度</li>
<li>innodb_row_lock_time_max： 从系统锁定到现在锁定最长的一次所花时间</li>
<li><strong>innodb_row_lock_time_avg</strong>：  从系统锁定到现在锁定的平均时长</li>
<li><strong>innodb_row_lock_waits</strong>：系统启动后到现在总共等待的次数</li>
</ul>
<h4 id="④-优化建议"><a href="#④-优化建议" class="headerlink" title="④ 优化建议"></a>④ 优化建议</h4><ul>
<li>尽可能让所有数据检索都通过索引来完成，避免无索引行锁升级为表锁</li>
<li>合理设计索引，尽量缩小锁的范围</li>
<li>尽可能减少检索条件，避免间隙锁</li>
<li>尽量控制事务大小，减少锁定资源量和时间长度</li>
<li>尽可能低级别事务隔离。</li>
</ul>
<h2 id="九、-主从复制"><a href="#九、-主从复制" class="headerlink" title="九、 主从复制"></a>九、 主从复制</h2><h3 id="①-复制过程"><a href="#①-复制过程" class="headerlink" title="① 复制过程"></a>① 复制过程</h3><ul>
<li><p>master将干煸记录到二进制日志（binary log）中，这些日志叫做二进制日志事件，binary log events。</p>
</li>
<li><p>slave将master的binary log events拷贝到它的中继日志（relay log）</p>
</li>
<li><p>slave重做中继日志中的事件，将改变应用到自己的数据库中，MySQL复制是异步且串行化的。</p>
<p><img src="https://beyonderwei-blog.oss-cn-shanghai.aliyuncs.com/article/mysql/MySQLAdvanced22.png" alt></p>
</li>
</ul>
<h3 id="②-复制原则"><a href="#②-复制原则" class="headerlink" title="② 复制原则"></a>② 复制原则</h3><ul>
<li>每个slave只能有一个master</li>
<li>买个slave只能有一个唯一的服务器ID</li>
<li>每个master可以有多个slave</li>
</ul>
<h3 id="③-复制的最大问题"><a href="#③-复制的最大问题" class="headerlink" title="③ 复制的最大问题"></a>③ 复制的最大问题</h3><ul>
<li>延时</li>
</ul>
<h3 id="④-一主一从"><a href="#④-一主一从" class="headerlink" title="④ 一主一从"></a>④ 一主一从</h3><ul>
<li>MySQL版本一致，且以后台服务运行</li>
<li>主从配置在[mysqld]节点下，都是小写</li>
<li>主机和从机都要关闭防火墙 <code>service iptables stop</code> 关闭linux防火墙</li>
</ul>
<h5 id="主机"><a href="#主机" class="headerlink" title="主机"></a>主机</h5><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主服务器唯一ID[必须]</span></span><br><span class="line"><span class="meta">server-id</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"># 启用二进制日志[必须]</span></span><br><span class="line"><span class="meta">log-bin</span>=<span class="string">"本地路径/mysqlbin"</span></span><br><span class="line"><span class="comment"># 启用错误日志[可选]  主从复制不成功可以记录下来</span></span><br><span class="line"><span class="meta">log-err</span>=<span class="string">"本地路径/mysqlerr"</span></span><br><span class="line"><span class="comment"># 根目录[可选]</span></span><br><span class="line"><span class="attr">basedir</span>=<span class="string">"自己本地路径"</span></span><br><span class="line"><span class="comment"># 临时目录[可选]</span></span><br><span class="line"><span class="attr">tmpdir</span>=<span class="string">"自己本地路径"</span></span><br><span class="line"><span class="comment"># 数据目录[可选]</span></span><br><span class="line"><span class="attr">datadir</span>=<span class="string">"本机的目录/Data"</span></span><br><span class="line"><span class="comment"># 主机读写都可以</span></span><br><span class="line"><span class="meta">read-only</span>=<span class="string">0</span></span><br><span class="line"><span class="comment"># 设置不需要复制的数据库（如mysql库）[可选]</span></span><br><span class="line"><span class="meta">binlog-ignore-db</span>=<span class="string">mysql</span></span><br><span class="line"><span class="comment"># 设置需要复制的数据库 [可选] 不写表示都复制</span></span><br><span class="line"><span class="meta">binlog-do-db</span>=<span class="string">需要复制的数据库名</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>在主机上给从机授权，登录后执行</p>
<p><code>GRANT REPLICATION SLAVE ON *.* TO &#39;用户名&#39; @‘从机IP’ IDENTIFIED BY &#39;密码&#39;;</code> </p>
</li>
<li><p><code>flush privileges;</code>   查询master的状态</p>
</li>
<li><p><code>show master status;</code>  查看主机二进制文件、复制和不复制的数据库信息</p>
</li>
</ul>
<h5 id="从机"><a href="#从机" class="headerlink" title="从机"></a>从机</h5><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主服务器唯一ID[必须]</span></span><br><span class="line"><span class="meta">server-id</span>=<span class="string">2</span></span><br><span class="line"><span class="comment"># 启用二进制日志[可选]</span></span><br><span class="line"><span class="meta">log-bin</span>=<span class="string">"本地路径/mysqlbin"</span></span><br></pre></td></tr></table></figure>
<ul>
<li><pre><code class="lang-shell">ChANGE MASTER TO MASTER_HOST=&#39;主机ip&#39;,
MASTER_USER=&#39;用户名&#39;,
MASTER_PASSWORD=&#39;密码&#39;,
MASTER_LOG_FILE=&#39;mysql.具体数字&#39;, MASTER_LOG_POS=具体值;
</code></pre>
<p>MASTER_LOG_FILE和MASTER_LOG_POS的值是在主机中通过<code>show master status</code> 查询到的。</p>
</li>
<li><p><code>start slave;</code>  重启服务，开启从服务器复制功能</p>
</li>
<li><p><code>show slave status\G</code>   以下两个参数都是yes说明配置成功</p>
<ul>
<li>Slave_IO_Running：Yes</li>
<li>Slave_SQL_Running：Yes</li>
</ul>
</li>
<li><p><code>stop slave;</code>    关闭复制，如果要重启，需要重新更改MASTER_LOG_FILE和MASTER_LOG_POS。</p>
</li>
</ul>
<h2 id="十、配置文件"><a href="#十、配置文件" class="headerlink" title="十、配置文件"></a>十、配置文件</h2><ul>
<li>log-bin    二进制日志，用于主从复制</li>
<li>log-error    错误日志，用于记录错误</li>
<li>log    查询日志，用于记录查询，当需要记录哪些SQL执行时间很慢时可以记录下来，用于优化</li>
<li><code>ls -lF|grep ^d</code>     进入容器后，查询创建的库的位置</li>
<li>数据文件<ul>
<li>frm文件    存放的数据库表结构</li>
<li>myd文件    存放的表数据</li>
<li>myi文件    存放的表索引 </li>
</ul>
</li>
</ul>

                
                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2020/01/10/前端通过MathJax显示数学公式（vue-MathJax）/" data-toggle="tooltip" data-placement="top" title="前端通过MathJax显示数学公式">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2020/01/02/注册-登录-实现过程详解/" data-toggle="tooltip" data-placement="top" title="注册-登录实现过程详解">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- tip start -->
                

                
                <div class="comment_notes">
                    <p>
                        本文为作者原创文章，未经作者允许不得转载。
                    </p>
                </div>
                
                <!-- tip end -->

                <!-- Music start-->
                
                

<link rel="stylesheet" href="/css/music-player/fonts/iconfont.css">


<link rel="stylesheet" href="/css/music-player/css/reset.css">


<link rel="stylesheet" href="/css/music-player/css/player.css">



<div class="music-player">
    <audio class="music-player__audio" ></audio>
    <div class="music-player__main">
        <div class="music-player__blur"></div>
        <div class="music-player__disc">
            <div class="music-player__image">
                <img width="100%" src="" alt="">
            </div>
            <div class="music-player__pointer"><img width="100%" src="/img/cd_tou.png" alt=""></div>
        </div>
        <div class="music-player__controls">
            <div class="music__info">
                <h3 class="music__info--title">...</h3>
                <p class="music__info--singer">...</p>
            </div>
            <div class="player-control">
                <div class="player-control__content">
                    <div class="player-control__btns">
                        <div class="player-control__btn player-control__btn--prev"><i class="iconfont icon-prev"></i></div>
                        <div class="player-control__btn player-control__btn--play"><i class="iconfont icon-play"></i></div>
                        <div class="player-control__btn player-control__btn--next"><i class="iconfont icon-next"></i></div>
                        <div class="player-control__btn player-control__btn--mode"><i class="iconfont icon-loop"></i></div>
                    </div>
                    <div class="player-control__volume">
                        <div class="control__volume--icon player-control__btn"><i class="iconfont icon-volume"></i></div>
                        <div class="control__volume--progress player_progress"></div>
                    </div>
                </div>
                <div class="player-control__content">
                    <div class="player__song--progress player_progress"></div>
                    <div class="player__song--timeProgess nowTime">00:00</div>
                    <div class="player__song--timeProgess totalTime">00:00</div>
                </div>

            </div>

        </div>
    </div>
</div>


<script src="/js/music-player/utill.js"></script>


<script src="/js/music-player/jquery.min.js"></script>


<script src="/js/music-player/player.js"></script>


                
                <!-- Music end -->

                <!-- Sharing -->
                
                <div class="social-share"  data-wechat-qrcode-helper="" align="center"></div>
                <!--  css & js -->
                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!-- Sharing -->

                <!-- gitment start -->
                
                <hr>
                <div id="blog_comments"></div>


<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>


<!--
<link rel="stylesheet" href="/css/gitment.css">
<script type="text/javascript" src="/js/gitment.js"></script>
-->

<script src="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/gitment.browser.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/theme-next/theme-next-gitment@1/default.css"/>

<!--
<link rel="stylesheet" href="https://billts.site/extra_css/gitment.css">
<script src="https://billts.site/js/gitment.js"></script>
-->

<script>
const myTheme = {
  render(state, instance) {
    const container = document.createElement('div')
    container.lang = "en-US"
    container.className = 'gitment-container gitment-root-container'
    
     // your custom component
    container.appendChild(instance.renderSomething(state, instance))
    
    container.appendChild(instance.renderHeader(state, instance))
    container.appendChild(instance.renderComments(state, instance))
    container.appendChild(instance.renderEditor(state, instance))
    //container.appendChild(instance.renderFooter(state, instance))
    return container
  },
  renderSomething(state, instance) {
    const container = document.createElement('div')
    container.lang = "en-US"
    container.className = 'hello_visitor'
    if (state.user.login) {
      container.innerText = `Hello ${state.user.login}, Welcome to comment system`
    }
    return container
  }
}


const gitment = new Gitment({
    id: 'Thu Jan 09 2020 14:26:43 GMT+0800', // optional
    owner: "beyonderwei",
    repo: "gitment",
    oauth: {
      client_id: "3154a4ba998ba4f00302",
      client_secret: "bdef21bcc8a5357adad5f7c9b0371e40034a8246",
    },
    theme: myTheme,
    // ...
    // For more available options, check out the documentation below
  })
  
  gitment.render('blog_comments')
  // or
  // gitment.render(document.getElementById('comments'))
  // or
  // document.body.appendChild(gitment.render())
</script>
                
                <!-- gitment end -->

                <!-- 来必力City版安装代码 -->
                
                <!-- City版安装代码已完成 -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->
            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#MySQL" title="MySQL">MySQL</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://blog.csdn.net/CSDN_X_W" target="_blank">CSDN</a></li>
                    
                        <li><a href="#" target="_blank">Web</a></li>
                    
                        <li><a href="https://github.com/Beyonderwei" target="_blank">Github</a></li>
                    
                        <li><a href="#" target="_blank">Other</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>


<style  type="text/css">
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">

                
                    <li>
                        <a target="_blank"  href="https://github.com/Beyonderwei">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://twitter.com/beyonderwei">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://www.facebook.com/beyonderwei">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/beyonderwei">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                

                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Beyonderwei 2022 
                    <br>
					瞌睡遇上枕头：
                    <a href="http://beian.miit.gov.cn" target="_blank" rel="noopener">吉ICP备20000556</a>
                    <!--<a href="https://github.com/dusign/hexo-theme-snail" target="_blank" rel="noopener">
                        <i>hexo-theme-snail</i>
                    </a> | 
                    <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0"
                        width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=dusign&repo=hexo-theme-snail&type=star&count=true">
                    </iframe>-->
                </p>
            </div>
        </div>
    </div>

</footer>

<!-- jQuery -->

<script src="/js/jquery.min.js"></script>


<!-- Bootstrap Core JavaScript -->

<script src="/js/bootstrap.min.js"></script>


<!-- Custom Theme JavaScript -->

<script src="/js/hux-blog.min.js"></script>


<!-- Search -->

<script src="/js/search.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://beyonderwei.com/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'yoursite';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->


<!-- Search -->

    <script type="text/javascript">      
        var search_path = "search.xml";
        if (search_path.length == 0) {
            search_path = "search.xml";
        }
    var path = "/" + search_path;
    searchFunc(path, 'local-search-input', 'local-search-result');
    </script>


<!-- busuanzi -->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>

    
        <!-- background effects line -->
        

        

        <!-- background effects end -->
    

    <!--<script size="50" alpha='0.3' zIndex="-999" src="/js/ribbonStatic.js"></script>-->
    
        <script src="/js/ribbonDynamic.js"></script>
    
</body>

</html>
